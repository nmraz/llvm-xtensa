; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc < %s -mtriple=xtensa | FileCheck %s
define i32 @extui_1bit(i32 %val) {
; CHECK-LABEL: extui_1bit:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 0, 1
; CHECK-NEXT:    ret.n
entry:
  %ext = and i32 %val, 1
  ret i32 %ext
}

define i32 @extui_2bit(i32 %val) {
; CHECK-LABEL: extui_2bit:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 0, 2
; CHECK-NEXT:    ret.n
entry:
  %ext = and i32 %val, 3
  ret i32 %ext
}

define i32 @extui_3bit(i32 %val) {
; CHECK-LABEL: extui_3bit:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 0, 3
; CHECK-NEXT:    ret.n
entry:
  %ext = and i32 %val, 7
  ret i32 %ext
}

define i32 @extui_4bit(i32 %val) {
; CHECK-LABEL: extui_4bit:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 0, 4
; CHECK-NEXT:    ret.n
entry:
  %ext = and i32 %val, 15
  ret i32 %ext
}

define i32 @extui_5bit(i32 %val) {
; CHECK-LABEL: extui_5bit:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 0, 5
; CHECK-NEXT:    ret.n
entry:
  %ext = and i32 %val, 31
  ret i32 %ext
}

define i32 @extui_8bit(i32 %val) {
; CHECK-LABEL: extui_8bit:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 0, 8
; CHECK-NEXT:    ret.n
entry:
  %ext = and i32 %val, 255
  ret i32 %ext
}

define i32 @extui_16bit(i32 %val) {
; CHECK-LABEL: extui_16bit:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 0, 16
; CHECK-NEXT:    ret.n
entry:
  %ext = and i32 %val, 65535
  ret i32 %ext
}

define i32 @extui_2bit_lshr1(i32 %val) {
; CHECK-LABEL: extui_2bit_lshr1:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 1, 2
; CHECK-NEXT:    ret.n
entry:
  %shr = lshr i32 %val, 1
  %ext = and i32 %shr, 3
  ret i32 %ext
}

define i32 @extui_2bit_lshr2(i32 %val) {
; CHECK-LABEL: extui_2bit_lshr2:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 2, 2
; CHECK-NEXT:    ret.n
entry:
  %shr = lshr i32 %val, 2
  %ext = and i32 %shr, 3
  ret i32 %ext
}

define i32 @extui_2bit_lshr3(i32 %val) {
; CHECK-LABEL: extui_2bit_lshr3:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 3, 2
; CHECK-NEXT:    ret.n
entry:
  %shr = lshr i32 %val, 3
  %ext = and i32 %shr, 3
  ret i32 %ext
}

define i32 @extui_2bit_lshr4(i32 %val) {
; CHECK-LABEL: extui_2bit_lshr4:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 4, 2
; CHECK-NEXT:    ret.n
entry:
  %shr = lshr i32 %val, 4
  %ext = and i32 %shr, 3
  ret i32 %ext
}

define i32 @extui_2bit_lshr8(i32 %val) {
; CHECK-LABEL: extui_2bit_lshr8:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 8, 2
; CHECK-NEXT:    ret.n
entry:
  %shr = lshr i32 %val, 8
  %ext = and i32 %shr, 3
  ret i32 %ext
}

define i32 @extui_2bit_lshr16(i32 %val) {
; CHECK-LABEL: extui_2bit_lshr16:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 16, 2
; CHECK-NEXT:    ret.n
entry:
  %shr = lshr i32 %val, 16
  %ext = and i32 %shr, 3
  ret i32 %ext
}

define i32 @extui_1bit_lshr31(i32 %val) {
; CHECK-LABEL: extui_1bit_lshr31:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 31, 1
; CHECK-NEXT:    ret.n
entry:
  %shr = lshr i32 %val, 31
  %ext = and i32 %shr, 1
  ret i32 %ext
}

define i32 @extui_2bit_ashr1(i32 %val) {
; CHECK-LABEL: extui_2bit_ashr1:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 1, 2
; CHECK-NEXT:    ret.n
entry:
  %shr = ashr i32 %val, 1
  %ext = and i32 %shr, 3
  ret i32 %ext
}

define i32 @extui_2bit_ashr2(i32 %val) {
; CHECK-LABEL: extui_2bit_ashr2:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 2, 2
; CHECK-NEXT:    ret.n
entry:
  %shr = ashr i32 %val, 2
  %ext = and i32 %shr, 3
  ret i32 %ext
}

define i32 @extui_2bit_ashr3(i32 %val) {
; CHECK-LABEL: extui_2bit_ashr3:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 3, 2
; CHECK-NEXT:    ret.n
entry:
  %shr = ashr i32 %val, 3
  %ext = and i32 %shr, 3
  ret i32 %ext
}

define i32 @extui_2bit_ashr4(i32 %val) {
; CHECK-LABEL: extui_2bit_ashr4:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 4, 2
; CHECK-NEXT:    ret.n
entry:
  %shr = ashr i32 %val, 4
  %ext = and i32 %shr, 3
  ret i32 %ext
}

define i32 @extui_2bit_ashr8(i32 %val) {
; CHECK-LABEL: extui_2bit_ashr8:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 8, 2
; CHECK-NEXT:    ret.n
entry:
  %shr = ashr i32 %val, 8
  %ext = and i32 %shr, 3
  ret i32 %ext
}

define i32 @extui_2bit_ashr16(i32 %val) {
; CHECK-LABEL: extui_2bit_ashr16:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 16, 2
; CHECK-NEXT:    ret.n
entry:
  %shr = ashr i32 %val, 16
  %ext = and i32 %shr, 3
  ret i32 %ext
}

define i32 @extui_1bit_ashr31(i32 %val) {
; CHECK-LABEL: extui_1bit_ashr31:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 31, 1
; CHECK-NEXT:    ret.n
entry:
  %shr = ashr i32 %val, 31
  %ext = and i32 %shr, 1
  ret i32 %ext
}

define i32 @extui_16bit_lshr16(i32 %val) {
; CHECK-LABEL: extui_16bit_lshr16:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 16, 16
; CHECK-NEXT:    ret.n
entry:
  %shr = lshr i32 %val, 16
  %ext = and i32 %shr, 65535
  ret i32 %ext
}

define i32 @extui_16bit_ashr16(i32 %val) {
; CHECK-LABEL: extui_16bit_ashr16:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 16, 16
; CHECK-NEXT:    ret.n
entry:
  %shr = ashr i32 %val, 16
  %ext = and i32 %shr, 65535
  ret i32 %ext
}

define i32 @extui_12bit_lshr20(i32 %val) {
; CHECK-LABEL: extui_12bit_lshr20:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 20, 12
; CHECK-NEXT:    ret.n
entry:
  %shr = lshr i32 %val, 20
  %ext = and i32 %shr, 4095
  ret i32 %ext
}

define i32 @extui_12bit_ashr20(i32 %val) {
; CHECK-LABEL: extui_12bit_ashr20:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 20, 12
; CHECK-NEXT:    ret.n
entry:
  %shr = ashr i32 %val, 20
  %ext = and i32 %shr, 4095
  ret i32 %ext
}

define i32 @not_extui_17bit(i32 %val) {
; CHECK-LABEL: not_extui_17bit:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    l32r a3, .LCPI25_0
; CHECK-NEXT:    and a2, a2, a3
; CHECK-NEXT:    ret.n
entry:
  %ext = and i32 %val, 131071
  ret i32 %ext
}

define i32 @not_extui_neg_lshr(i32 %val) {
; CHECK-LABEL: not_extui_neg_lshr:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    ssai 31
; CHECK-NEXT:    srl a2, a2
; CHECK-NEXT:    extui a2, a2, 0, 1
; CHECK-NEXT:    ret.n
entry:
  %shr = lshr i32 %val, -1
  %ext = and i32 %shr, 1
  ret i32 %ext
}

define i32 @not_extui_neg_ashr(i32 %val) {
; CHECK-LABEL: not_extui_neg_ashr:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    ssai 31
; CHECK-NEXT:    sra a2, a2
; CHECK-NEXT:    extui a2, a2, 0, 1
; CHECK-NEXT:    ret.n
entry:
  %shr = ashr i32 %val, -1
  %ext = and i32 %shr, 1
  ret i32 %ext
}

define i32 @not_extui_2bit_lshr31(i32 %val) {
; CHECK-LABEL: not_extui_2bit_lshr31:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 31, 1
; CHECK-NEXT:    ret.n
entry:
  %shr = lshr i32 %val, 31
  %ext = and i32 %shr, 3
  ret i32 %ext
}

define i32 @not_extui_2bit_ashr31(i32 %val) {
; CHECK-LABEL: not_extui_2bit_ashr31:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    srai a2, a2, 31
; CHECK-NEXT:    extui a2, a2, 0, 2
; CHECK-NEXT:    ret.n
entry:
  %shr = ashr i32 %val, 31
  %ext = and i32 %shr, 3
  ret i32 %ext
}

define i32 @not_extui_16bit_lshr17(i32 %val) {
; CHECK-LABEL: not_extui_16bit_lshr17:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    extui a2, a2, 17, 15
; CHECK-NEXT:    ret.n
entry:
  %shr = lshr i32 %val, 17
  %ext = and i32 %shr, 65535
  ret i32 %ext
}

define i32 @not_extui_16bit_ashr17(i32 %val) {
; CHECK-LABEL: not_extui_16bit_ashr17:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    srai a2, a2, 17
; CHECK-NEXT:    extui a2, a2, 0, 16
; CHECK-NEXT:    ret.n
entry:
  %shr = ashr i32 %val, 17
  %ext = and i32 %shr, 65535
  ret i32 %ext
}

define i32 @not_extui_non_mask(i32 %val) {
; CHECK-LABEL: not_extui_non_mask:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    movi.n a3, 5
; CHECK-NEXT:    and a2, a2, a3
; CHECK-NEXT:    ret.n
entry:
  %ext = and i32 %val, 5
  ret i32 %ext
}
